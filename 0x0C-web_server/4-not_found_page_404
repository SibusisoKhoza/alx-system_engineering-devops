#!/usr/bin/env bash
# Script that installs Nginx server, redirects /redirect_me and customizes 404 not found

# Check if running as root
if [ "$EUID" -ne 0 ]; then
  echo "Please run the script as root or using sudo."
  exit 1
fi

# Update package list
apt-get update -y

# Install nginx
apt-get install nginx -y

# Create a basic HTML file with "Ceci n'est pas une page" content
echo "Ceci n'est pas une page" | tee /usr/share/nginx/html/404.html > /dev/null

# Ensure nginx is running
service nginx start

# Configure nginx to use the custom 404 page
file="/etc/nginx/sites-available/default"

# Add or modify the error_page and location configuration for 404
config_block="\
error_page 404 /404.html;\n\
location = /404.html {\n\
    root /usr/share/nginx/html;\n\
    internal;\n\
}\n\
"

# Insert the configuration block into the server block
sed -i "/server {/a $config_block" "$file"

# Reload nginx to apply changes
service nginx reload

# Check if nginx is running
service nginx status

# Output success message
echo "Nginx has been configured with a custom 404 page."
